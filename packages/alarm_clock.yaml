automation:
  - id: michaels_alarm
    alias: Michaels Alarm
    trigger:
      platform: template
      value_template: '{{ as_timestamp(states.sensor.date__time.last_updated) | timestamp_custom("%H:%M:00") == states.input_datetime.alarm_clock.state }}'
    action:
      - service: light.turn_on
        entity_id: light.michaels_side
        data:
          brightness_pct: 75
          kelvin: 2700
          transition: 18000 #30 minute transition
      - service: notify.slack
        data_template: 
          message: ':alarm_clock: Michaels Alarm'
  - id: reset_michaels_alarm
    alias: Reset Michael's Alarm
    trigger:
      platform: template
      value_template: '{{ as_timestamp(states.sensor.date__time.last_updated) + 3600 | timestamp_custom("%H:%M:00") == states.input_datetime.alarm_clock.state }}'
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: '{{ states.light.marys_side.state != "off"}}'
        - condition: template
          value_template: '{{ states.light.michaels_side.state != "on"}}'
    action:
      - service: light.turn_off
        entity_id: light.michaels_side
      - service: notify.slack
        data_template: 
          message: ':alarm_clock: Resetting Michaels Alarm, 60 Minutes have elapsed'

input_datetime:
  alarm_clock:
    name: Alarm Clock
    has_date: false
    has_time: true
    initial: '1970-01-01 06:15'

group:
  alarm_clock:
    name: Alarm Clock
    view: no
    icon: mdi:alarm
    entities:
      - input_datetime.alarm_clock
      - automation.michaels_alarm